<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CalculGEA — AERYSGIN (v19)</title>

<!-- PWA iPhone -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<link rel="manifest" href="manifest.webmanifest?v=19">
<meta name="theme-color" content="#0A84FF"/>

<style>
  /* ===== Thème Bleu Océan ===== */
  :root{
    --bg:#0F1B2D;
    --fg:#F6FAFF;
    --muted:#A9C2D8;
    --card:#14263D;
    --line:#264766;
    --brand:#0A84FF;
    --accent:#3BA6FF;
  }
  *{box-sizing:border-box} html,body{margin:0}
  body{background:var(--bg);color:var(--fg);font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto}
  header{
    position:sticky;top:0;
    background: linear-gradient(180deg, rgba(10,132,255,.20), rgba(10,132,255,.08));
    border-bottom:1px solid rgba(255,255,255,.08);
    backdrop-filter: blur(6px);
  }
  .wrap{max-width:1060px;margin:0 auto;padding:16px}
  h1{margin:0;font-size:18px}
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px;margin-top:16px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px}
  .span-4{grid-column:span 4}.span-6{grid-column:span 6}.span-8{grid-column:span 8}.span-12{grid-column:span 12}
  @media (max-width:900px){.span-4,.span-6,.span-8,.span-12{grid-column:span 12}}
  label{display:block;font-size:12px;color:var(--muted);margin:8px 0 6px}
  input, select{
    width:100%;padding:10px 12px;
    background:#0F2238;color:#fff;
    border:1px solid var(--line);border-radius:12px;outline:none;
    box-shadow: inset 0 0 0 9999px rgba(255,255,255,0);
  }
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .btn{
    padding:11px 14px;border-radius:12px;
    border:1px solid var(--line);
    background: linear-gradient(180deg, var(--brand), #086ada);
    color:#fff;cursor:pointer;opacity:.95;
  }
  .btn:hover{opacity:1}
  .btn.enabled{opacity:1}
  .kpis{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
  .kpi{padding:12px;border:1px dashed var(--line);border-radius:12px}
  .kpi small{display:block;color:var(--muted)}
  .kpi b{font-size:18px}
  .badge{display:inline-block;padding:4px 8px;border-radius:999px;
    border:1px solid rgba(59,166,255,.6);font-size:12px;
    background:rgba(59,166,255,.12);color:#cfe9ff}
  .muted{color:var(--muted);font-size:12px}
  footer{color:var(--muted);text-align:center;padding:14px}

  /* Impression/PDF clair */
  @media print {
    :root{color-scheme: light;}
    *{-webkit-print-color-adjust: exact;print-color-adjust: exact}
    body, header, main, footer, .card{background:#fff !important;color:#000 !important}
    .card{border:1px solid #999 !important}
    .kpi{border-color:#bbb !important}
    .badge{border-color:#999 !important;background:#fff !important;color:#000 !important}
    .btn, .actions-top, #scenarioWrap{display:none !important}
    a{color:#000 !important}
  }
</style>
</head>
<body>
<header>
  <div class="wrap row actions-top" style="justify-content:space-between">
    <div class="row">
      <div style="width:36px;height:36px;border-radius:8px;background:conic-gradient(from 45deg,var(--brand),var(--accent),var(--brand));margin-right:10px"></div>
      <div>
        <h1>CalculGEA — <span style="color:var(--accent)">AERYSGIN</span></h1>
        <div class="muted">PWA v19 · Simulateur ROI & sélection automatique GENAQ</div>
      </div>
    </div>
    <div class="row">
      <button class="btn" id="btnCsvTop">Exporter CSV</button>
      <button class="btn" id="btnPdfTop">Exporter PDF</button>
    </div>
  </div>
</header>

<main class="wrap">
  <div id="err" class="muted" style="display:none;color:#ffd7db;background:#3b0c12;border:1px solid #641a22;padding:8px;border-radius:8px"></div>

  <div class="grid">
    <section class="card span-4 inputs">
      <h2 style="margin:0 0 8px">Informations client</h2>
      <label>Société <input id="company" placeholder="Nom de la société"></label>
      <label>Nom et prénom <input id="clientName" placeholder="Nom Prénom"></label>
      <label>Fonction <input id="clientRole" placeholder="Fonction"></label>

      <div id="scenarioWrap" style="margin-top:12px">
        <label>Scénario (pré-remplissage)</label>
        <select id="scenario">
          <option value="">— Choisir un scénario —</option>
          <option value="famille">Famille (max 10 pers.)</option>
          <option value="pme">Bureau / PME (50 pers.)</option>
          <option value="hotel">Hôtel 3★ (80 chambres)</option>
          <option value="ecole">École (500 élèves)</option>
          <option value="chantier">Chantier (200 pers.)</option>
          <option value="secours">Base de secours</option>
          <option value="village">Village isolé (100 foyers)</option>
        </select>
      </div>

      <h2 style="margin:16px 0 8px">Paramètres</h2>
      <label>Besoin (L/jour) <input id="demand" value="200"></label>
      <label>Prix eau (€/L) <input id="bottle" value="0,60"></label>
      <label>Jours/an <input id="days" value="365"></label>
      <label>kWh/L du GEA <input id="kwhL" value="0,35"></label>
      <label>Disponibilité (0–1) <input id="uptime" value="0,95"></label>
      <label>Facteur climat (0–1) <input id="climate" value="1,00"></label>

      <label>CAPEX AWG (€) <input id="capex_awg" value="10000"></label>
      <label>Installation (€) <input id="install" value="1000"></label>
      <label>Maintenance/an (€) <input id="maint" value="1000"></label>
      <label>Prix réseau (€/kWh) <input id="grid" value="0,25"></label>
      <label>PV kWc <input id="pvkwp" value="5"></label>
      <label>Rdt PV (kWh/kWc/an) <input id="pvyield" value="950"></label>
      <label>CAPEX PV (€/kWc) <input id="pvcap" value="1200"></label>

      <label>Durée projet (ans) <input id="years" value="10"></label>
      <label>Taux actualisation <input id="disc" value="0,08"></label>

      <label>Plastique (g/L) <input id="plastg" value="20"></label>
      <label>CO₂ plastique (kg/kg) <input id="pco2" value="2,7"></label>
      <label>CO₂ réseau (kg/kWh) <input id="gco2" value="0,23"></label>

      <div class="row" style="margin-top:10px">
        <button class="btn primary" id="calcBtn" type="button">Calculer</button>
      </div>
      <p class="muted">Décimales : virgule ou point acceptés.</p>
    </section>

    <section class="card span-8">
      <h2 style="margin:0 0 8px">Résumé exécutif</h2>
      <div id="clientInfo" class="muted"></div>
      <div class="kpis" id="summary"><p class="muted">Clique “Calculer”.</p></div>
    </section>

    <section class="card span-12">
      <h2 style="margin:0 0 8px">Finance</h2>
      <div id="finance"><p class="muted">Les résultats s’affichent ici.</p></div>
    </section>

    <section class="card span-6">
      <h2 style="margin:0 0 8px">Impacts</h2>
      <div id="impacts"><p class="muted">Après calcul.</p></div>
    </section>

    <section class="card span-6">
      <h2 style="margin:0 0 8px">Détails modèle</h2>
      <div id="details"><p class="muted">Après calcul.</p></div>
    </section>

    <section class="card span-12">
      <div class="row" style="justify-content:flex-end">
        <button class="btn" id="btnCsvBottom">Exporter CSV</button>
        <button class="btn" id="btnPdfBottom">Exporter PDF</button>
      </div>
    </section>
  </div>
</main>

<footer>© AERYSGIN — Outil estimatif ; performances réelles dépendantes du site et du climat.</footer>

<script>
/* ===== Modèles ===== */
const MODELS = [
  {name:"Stratus S50",   lpd:52,   type:"Distributeur"},
  {name:"Stratus S200",  lpd:200,  type:"Distributeur"},
  {name:"Cumulus C500",  lpd:573,  type:"Outdoor/Emergency"},
  {name:"Cumulus C5000", lpd:5192, type:"Container/Industrial"},
];

/* ===== Scénarios ===== */
const SCENARIOS = {
  famille:{label:"Famille (max 10 pers.)", demand:300, days:365, bottle:0.5, kwhL:0.32, uptime:0.95, climate:1.0,
           capex_awg:8000, install:800, maint:600, grid:0.25, pvkwp:2, pvyield:950, pvcap:1200, years:8, disc:0.08,
           plastg:20, pco2:2.7, gco2:0.23},
  pme:{label:"Bureau / PME (50 pers.)", demand:150, days:250, bottle:0.6, kwhL:0.35, uptime:0.95, climate:1.0,
       capex_awg:10000, install:1000, maint:1000, grid:0.25, pvkwp:3, pvyield:950, pvcap:1200, years:10, disc:0.08,
       plastg:20, pco2:2.7, gco2:0.23},
  hotel:{label:"Hôtel 3★ (80 chambres)", demand:240, days:365, bottle:0.6, kwhL:0.35, uptime:0.95, climate:1.0,
         capex_awg:15000, install:2000, maint:1500, grid:0.25, pvkwp:10, pvyield:1000, pvcap:1100, years:12, disc:0.08,
         plastg:20, pco2:2.7, gco2:0.23},
  ecole:{label:"École (500 élèves)", demand:750, days:180, bottle:0.5, kwhL:0.35, uptime:0.95, climate:1.0,
         capex_awg:18000, install:1500, maint:1200, grid:0.22, pvkwp:12, pvyield:950, pvcap:1100, years:10, disc:0.07,
         plastg:20, pco2:2.7, gco2:0.22},
  chantier:{label:"Chantier (200 pers.)", demand:600, days:300, bottle:0.7, kwhL:0.38, uptime:0.90, climate:0.9,
            capex_awg:16000, install:1500, maint:1600, grid:0.30, pvkwp:15, pvyield:900, pvcap:1000, years:5, disc:0.10,
            plastg:25, pco2:2.7, gco2:0.30},
  secours:{label:"Base de secours", demand:500, days:365, bottle:0.8, kwhL:0.36, uptime:0.95, climate:0.95,
           capex_awg:20000, install:2000, maint:1800, grid:0.28, pvkwp:20, pvyield:1000, pvcap:1000, years:8, disc:0.09,
           plastg:25, pco2:2.7, gco2:0.28},
  village:{label:"Village isolé (100 foyers)", demand:800, days:365, bottle:0.5, kwhL:0.34, uptime:0.95, climate:0.95,
           capex_awg:25000, install:3000, maint:2000, grid:0.20, pvkwp:25, pvyield:1100, pvcap:900, years:15, disc:0.07,
           plastg:20, pco2:2.7, gco2:0.20},
};

/* ===== Fonctions utilitaires (num, euro, fmt, setVal...) ===== */
/* (Même logique que v18, conservée) */
</script>
</body>
</html>
